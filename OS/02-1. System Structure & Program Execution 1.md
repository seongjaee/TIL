# 운영체제 강의 정리

## 02-1. System Structure & Program Execution 1

### 컴퓨터 시스템 구조

- 메모리 - CPU의 작업 공간
  - OS
  - 메모리 컨트롤러

- CPU - 메모리에서 매 클럭 사이클마다 기계어를 읽어와서 실행
  - 레지스터
  - mode bit
  - 인터럽트 라인

- IO 디바이스
  - 디바이스 컨트롤러 : 디바이스를 전담하는 CPU 같은 것들.
  - 로컬 버퍼 : 디바이스 작업 공간

- timer - CPU 타임 셰어링

### Mode bit

- 0 : 커널 모드, OS 코드 수행
- 1 : 사용자 모드, 사용자 프로그램 수행

보안 관련 중요한 명령어는 커널 모드로만 실행 가능.

사용자 모드일 때는 인스트럭션 제한.

사용자 프로그램의 잘못된 수행으로 다른 프로그램 및 운영체제에 피해가 가지 않도록 하기 위한 보호장치

Interrupt, Exception 발생시 하드웨어가 mode bit 0으로 바꿈

사용자 프로그램에게 CPU를 넘기기 전에 mode bit을 1로 바꿈

### Timer

- 정해진 시간이 흐른 뒤 OS에게 제어권이 넘어가도록 인터럽트 발생
- 매 클럭 틱 때마다 1씩 감소, 0이 되면 타이머 인터럽트 발생
- 특정 프로그램의 CPU 독점 보호
- time sharing 구현에 이용
- 현재 시간 계산에 이용

### Device Controller

- IO 전담 일종의 작은 CPU

- 제어 정보를 위한 컨트롤 레지스터, 스테이터스 레지스터

- 로컬 버퍼를 가짐(일종의 데이터 레지스터)
- IO는 실제 디바이스와 로컬 버퍼 사이에서 일어남
- IO 끝나면 디바이스 컨트롤러가 인터럽트로 CPU에 그 사실을 전달

### DMA controller

Direct Memory Access

Memory controller가 제어

IO 작업 중간중간에 CPU에 인터럽트를 걸지 않고, IO 작업 내용을 직접 메모리로 복사

CPU에 인터럽트를 한 번만 걸어서 메모리에 작업이 완료됐음을 알림

### 입출력의 수행

- 모든 IO 명령은 특권 명령
- 사용자 프로그램이 IO 하는 방법
  - 시스템 콜 : 사용자 프로그램이 OS에 IO 요청
  - trap을 사용해 인터럽트 벡터의 특정 위치로 이동
  - 제어권이 인터럽트 벡터가 가리키는 인터럽트 서비스 루틴으로 이동
  - 올바른 IO 요청인지 확인 후 IO 수행
  - IO 완료 시 제어권을 시스템 콜 다음 명령으로 옮김

### 인터럽트

인터럽트 당한 시점의 레지스터와 프로그램 카운터를 save 한 후 CPU의 제어를 인터럽트 처리 루틴에 넘김.

- 넓은 의미의 인터럽트

  - 하드웨어 인터럽트 : 하드웨어가 발생시킨 인터럽트

  - Trap, 소프트웨어 인터럽트
    - Exception : 프로그램이 오류를 범한 경우
    - System call : 프로그램이 커널 함수를 호출하는 경우

- 인터럽트 관련 용어

  - 인터럽트 벡터 : 해당 인터럽트의 처리 루틴 주소를 가지고 있음
  - 인터럽트 처리 루틴 : 해당 인터럽트를 처리하는 커널 함수

### 시스템콜

사용자 프로그램이 OS의 서비스를 받기 위해 커널 함수를 호출하는 것

