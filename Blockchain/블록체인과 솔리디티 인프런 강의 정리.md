# 블록체인과 솔리디티 인프런 강의 정리

## 블록체인

### 블록체인

블록체인이란 말그래도 블록이 연결된 체인, 블록 = 데이터 집합

블록체인은 모든 사용자가 동일하게 들고 있음.

지금까지의 보안은 최소한의 사람이 관리하는 폐쇄적.

블록체인은 가능한 많은 사람에게 권한과 정보를 주는 방식.

암호학을 기반으로 설계,

### 블록체인과 암호학

**머클 트리**는 머클이 만든 트리 구조.

해시가 이용된 데이터 검증을 위한 트리 구조.

**라이트 노드**와 **거래 검증**의 핵심요소

**라이트 노드**란 모든 블록 정보를 담은게 아닌 머클 루트 값만 가지고 있는 노드.

머클 트리는 다음과 같은 이진 트리.

![image-20220221163516648](C:\Users\multicampus\AppData\Roaming\Typora\typora-user-images\image-20220221163516648.png)

노드 중 어떤 값이 변경되면 루트의 값도 변경됨. 따라서 머클 노드 값만 알고 있어도 데이터 위변조 감지 가능. 이로 인해 성능이 떨어지는 기기도 블록체인에 참여 가능.

**거래 검증**

쉬운 거래 검증.

4라는 거래 기록이 있는지 확인하기 위해, 4의 짝노드인 3과 4의 부모노드의 짝노드인 12를 이용해 4를 검증할 수 있음.

### 블록체인의 활용

암호화폐가 대표적.

가장 큰 이유 블록체인은 가치전달이 가능함. 기존 인터넷은 정보 전달 역할 이었음.

예를 들어 계좌 송금은 은행이라는 중간자의 DB에서 A계좌에서 금액을 빼고, B계좌에서 금액을 늘리는 가치 정보를 바꾸는 것 뿐임. 실제 돈이 전달되는 것은 아님.

하지만 블록체인에서의 거래는 그 자체로 가치가 전달됨.

그 가치는 금전적인 가치뿐이었으나, 2세대 암호화폐부터는 가치가 있는 데이터로까지 확장됨.

### 이더리움과 스마트 컨트랙트

이더리움 : 이더리움 재단이 운영하는 암호화폐이자, 블록체인 플랫폼.

이더리움은 블록체인 플랫폼으로써 이더리움 위에 스마트 컨트랙트를 작성할 수 있도록 만들어짐. 스마트 컨트랙트는 블록체인 위에서의 계약서임.

스마트 컨트랙트는 과정을 블록체인에 담는 것이라고 볼 수 있음.

Decentralized Application(DApp) 이더리움 플랫폼 위에 올라가있는 어플리케이션. 이를 이용해 특정 조건에서만 실행되는 계약을 만들 수 있고, 무결한 블록체인에 의해 정확히 실행 됨. 튜링 완전 언어 내장.

### 블록체인과 이더리움의 문제

#### 프라이버시

블록 체인은 조작이 불가능하고 평생 기록이 남음. 그로 인해 프라이버시 문제 존재

#### 트랜잭션 코스트

이더리움에서 트랜잭션을 수행할 때 가스라는 수수료를 내게됨. 사용자가 부담. 이더리움 가격이 오를 때마다 같이 오르는 수수료는 사용자에게 부담.

#### 트랜잭션 스피드

중앙화된 처리에 비해 상당히 느린 거래 처리 속도. 비자 카드의 처리 속도는 1초에 약 2000개, 이더리움은 1초에 약 20개. 중앙 처리 시스템은 거래 즉시 효력을 갖으나, 이더리움은 약 10번 정도의 확인 후 무결 판단. 시간상 약 3분

#### 블록 사이즈

모든 채굴자가 모든 블록을 가지고 있으므로 용량이 큼. 매달 약 2GB정도의 블록이 추가되므로 금방 매우 큰 용량이 필요.

#### => 블록체인이 모든 경우의 정답은 아니다.

## 솔리디티

### 솔리디티

스마트 컨트랙트를 만들기 위한 언어, 이더리움 가상 머신을 타겟으로 디자인 됨.

EVM

가상 머신. 이더리움 네트워크 노드들이 공유하는 하나의 거대한 머신.

솔리디티는 정적 타입이고 상속, 라이브러리, 유저 정의 타입 등 여러가지 기능을 제공, 스마트 컨트랙트는 블록체인 특성상 한 번 블록체인 위에 올리면 바꿀 수 없고, 누구나 확인 가능하므로, 신중히 작성해야함.

이 강의에서는 remix.ethereum.org, remix라는 솔리디티 에디터 사용. 웹 브라우저에서 사용가능한 IDE.

### 솔리디티 특징

#### 튜링 완전

솔리디티는 튜링 완전하다. => 복잡.

msg.sender와 msg.value라는 특별한 변수가 있음.

`msg.sender` : 메시지를 보낸 주소

`msg.value` : 메시지를 보낸 값

### 스마트 컨트랙트

스마트 컨트랙트의 구조

클래스와 비슷

상태변수, 함수, 함수 변경자, 이벤트, 구조체, 열거형 등 포함.

상속, 다형성 지원.

```solidity
// 1. 컨트랙트 선언
contract Sample {
    // 2. 상태 변수 선언
    uint256 data;
    address owner;
    
    // 3. 이벤트 정의
    event logData(uint256 dataToLog);
    
    // 4. 함수 변경자 정의
    modifier onlyOwner() {
        if(msg.sender != owner) revert();
        _;
    }
    
    // 5. 생성자
    function Sample(uint256 initData, address initOwner) {
        data = initData;
        onwer = initOwner;
    }
    
    // 6. 함수(메소드) 정의
    function getData() returns (uint256 returned) {
        return data;
    }
    function setData(uint256 newData) onlyOwner {
        logData(newData);
        data = newData;
    }
}
```

#### 솔리디티 데이터 타입

기존 언어와 대부분 동일

특이한 부분

string과 bytes 둘다 문자열 표현 둘의 차이 : string은 UTF8로 인코딩

mapping : 키와 밸류의 쌍,

동적 배열과 정적 배열 모두 사용 가능.

interface로 추상 계층 작성 가능

modifier라는 한정자, 함수 선언시 같이 선언하면 함수를 실행시키는 조건.

다른 언어의 decorator와 비슷.

### 데이터위치와 문법

#### 데이터 위치

- storage - 상태 변수, 로컬 변수
- memory : 로컬 변수

storage는 블록체인 내 저장, memory는 사용 후 휘발.

#### 솔리디티 문법

if, else, while, for, break, continue, return, ? :(삼항 연산자)

### 가시성

누가 접근 가능한지 정의

external, public, internal, private

- external

  external은 다른 컨트랙트나 트랜잭션을 통해서만 호출 가능

  - `f()` 동작 X,
  - `this.f()` 동작 O,

- public

  모든 방법으로 접근 가능, getter 함수 자동 생성 값을 가져올 수 있음

- internal

  내부적으로만 접근 가능, 접근을 위해 `this` 사용할 수 없음.

- private

  internal과 비슷하지만, 상속된 컨트랙트에서는 접근 불가

### 가스

EVM에서 무언가가 실행될 때 가스가 발생. 쉽게 생각하면 수수료.

가스는 두가지 요소

- gasLimit
  - 수수료의 한계치
  - 낮게 설정 시 일을 마치기 전 가스를 다 쓰게 됨.
  - 이 경우 일을 취소시키고 사용된 가스를 돌려주지 않음.
  - 채굴자들이 일을 했기 때문에 돌려주지 않음

- gasPrice
  - 가스당 가격
  - 이 가격이 올라가면 채굴자들은 수수료를 많이 받기 때문에 비싼 gasPrice가 먼저 채굴되는 경향
  - gasPrice * 가스 사용량 = 수수료

신중하게 스마트 컨트랙트를 짜야함.



